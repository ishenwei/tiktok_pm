{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}
    {{ block.super }}
    <style>
        /* =========================================
           1. é¡¶éƒ¨ä¿å­˜æ æ ·å¼ (Top Submit Row)
           ========================================= */
        .top-submit-row {
            padding: 10px 14px;
            margin: 0 0 20px;
            background: var(--darkened-bg, #262626); /* ä½¿ç”¨å˜é‡é€‚é…æ·±è‰² */
            border: 1px solid var(--hairline-color, #444);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            flex-wrap: wrap;
        }

        .top-submit-row input[type="submit"] {
            margin-right: 8px;
            margin-bottom: 0 !important;
        }

        .top-submit-row .deletelink {
            display: none !important;
        }

        @media (max-width: 767px) {
            .top-submit-row {
                display: block !important;
            }
            .top-submit-row input[type="submit"] {
                width: 100%;
                margin-bottom: 10px !important;
                margin-right: 0;
            }
        }

        /* =================================================
           2. ç´§å‡‘æ¨¡å¼æ ·å¼ (Compact Mode)
           ================================================= */
        .form-row {
            padding: 4px 10px !important;
        }

        .aligned label {
            padding-top: 3px !important;
            line-height: 1.2 !important;
        }

        /* æ™®é€šè¾“å…¥æ¡†ç¼©å° */
        .vTextField,
        input[type="text"]:not(.select2-search__field),
        input[type="number"],
        input[type="url"],
        select:not([style*="display: none"]) {
            width: 300px !important;
            max-width: 100%;
            height: 28px !important;
            padding: 2px 5px !important;
            font-size: 13px !important;
            background-color: var(--darkened-bg, #262626); /* ç¡®ä¿èƒŒæ™¯æ·±è‰² */
            color: var(--body-fg, #eee); /* ç¡®ä¿æ–‡å­—æµ…è‰² */
            border: 1px solid var(--hairline-color, #444);
        }

        /* ç‰¹æ®Šå­—æ®µå®½åº¦è°ƒæ•´ */
        .field-initial_price input, .field-final_price input, .field-stock input,
        .field-sold input, .field-position input { width: 100px !important; }

        .field-url input, .field-category_url input, .field-image_original_url input, textarea {
            width: 600px !important;
        }

        textarea { height: 60px !important; }

        /* =================================================
           3. ğŸŒŸ Select2 æ·±è‰²æ¨¡å¼å®Œç¾é€‚é… (Dark Mode Fixes)
           ================================================= */

        /* A. è¾“å…¥æ¡†å®¹å™¨ (æœªå±•å¼€æ—¶) */
        .select2-container .select2-selection--multiple {
            min-height: 28px !important;
            background-color: var(--darkened-bg, #262626) !important;
            border: 1px solid var(--hairline-color, #444) !important;
        }

        /* æ ‡ç­¾æ–‡å­—é¢œè‰² */
        .select2-container--default .select2-selection--multiple .select2-selection__rendered {
            padding: 0 5px !important;
            color: var(--body-fg, #eee) !important;
        }

        /* ğŸŒŸ æ ¸å¿ƒä¿®å¤ï¼šé€‰ä¸­åçš„èƒ¶å›Šæ ·å¼ (Capsule) ğŸŒŸ */
        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            margin-top: 4px !important;
            margin-right: 4px !important;

            /* å…³é”®ä¿®æ”¹ï¼šèƒŒæ™¯æ”¹æ·±è‰²ï¼Œè¾¹æ¡†æ”¹æ·±è‰² */
            background-color: #444 !important;
            border: 1px solid #555 !important;

            color: #fff !important; /* æ–‡å­—ç™½è‰² */
            border-radius: 4px !important;
            padding-left: 20px !important; /* ç»™å·¦è¾¹çš„ x æŒ‰é’®ç•™ä½ç½® */
            padding-right: 5px !important;
            position: relative; /* ç”¨äºå®šä½ x æŒ‰é’® */
        }

        /* ğŸŒŸ æ ¸å¿ƒä¿®å¤ï¼šèƒ¶å›Šä¸Šçš„ 'x' åˆ é™¤æŒ‰é’® ğŸŒŸ */
        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
            color: #bbb !important; /* æµ…ç°è‰² x */
            border-right: 1px solid #555 !important; /* åˆ†éš”çº¿ */
            position: absolute !important;
            left: 0 !important;
            top: 0 !important;
            bottom: 0 !important;
            width: 20px !important;
            display: flex !important;
            align-items: center;
            justify-content: center;
            margin-right: 0 !important;
            font-weight: bold;
            transition: 0.2s;
        }

        /* é¼ æ ‡æ‚¬åœåœ¨ x ä¸Šæ—¶å˜çº¢ */
        .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
            background-color: #cc3333 !important;
            color: white !important;
        }

        /* B. ä¸‹æ‹‰èœå•æœ¬ä½“ (å±•å¼€å) */
        .select2-dropdown {
            background-color: #2b2b2b !important;
            border: 1px solid #444 !important;
            z-index: 99999 !important;
        }

        /* C. ä¸‹æ‹‰é€‰é¡¹æ–‡å­— */
        .select2-results__option {
            color: #eee !important;
            padding: 6px 10px !important;
        }

        /* D. é€‰ä¸­é¡¹çš„é«˜äº®æ ·å¼ */
        .select2-container--default .select2-results__option--highlighted[aria-selected] {
            background-color: #447e9b !important;
            color: white !important;
        }

        /* E. é€‰ä¸­åçš„é€‰é¡¹ (aria-selected="true") */
        .select2-container--default .select2-results__option[aria-selected=true] {
            background-color: #444 !important;
        }

        /* F. ä¸‹æ‹‰èœå•é‡Œçš„æœç´¢æ¡† */
        .select2-search--dropdown .select2-search__field {
            background-color: #333 !important;
            color: #eee !important;
            border: 1px solid #555 !important;
        }
    </style>
{% endblock %}

{% block field_sets %}
    <div class="submit-row top-submit-row">
        {% submit_row %}
    </div>
    {{ block.super }}
{% endblock %}

{% block submit_buttons_bottom %}
    {{ block.super }}
    {% if original %}
        <div class="submit-row">
            <a class="button"
               href="{% url 'admin:products_product_download-images' original.pk %}"
               style="background-color: #447e9b; color: white;">
                ğŸ“¥ ä¸€é”®ä¸‹è½½æ‰€æœ‰å•†å“å›¾ç‰‡
            </a>
        </div>
    {% endif %}
{% endblock %}